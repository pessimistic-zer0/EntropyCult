# Hard-Block Patterns for Prompt Injection Detection
# These patterns trigger high-confidence signals (weight 50-70)
# Group by intent for maintainability

# =============================================================================
# INSTRUCTION OVERRIDE - attempts to reset/ignore prior instructions
# =============================================================================
override_instructions:
  weight: 60
  description: "Attempts to override, ignore, or reset prior instructions"
  patterns:
    # Direct override phrases
    - id: override_ignore_previous
      regex: "\\bignore\\s+(all\\s+)?(previous|prior|above|earlier|preceding)(\\s+instructions?|\\s+prompts?|\\s+rules?|\\s+context)?\\b"
      description: "ignore previous instructions"
    
    - id: override_disregard
      regex: "\\bdisregard\\s+(all\\s+)?(previous|prior|above|earlier|preceding)\\b"
      description: "disregard previous"
    
    - id: override_forget_everything
      regex: "\\bforget\\s+(everything|things|all|what)\\s+(you\\s+)?(know|learned|were\\s+told|said|I\\s+said)\\b"
      description: "forget everything/things/all"
    
    - id: override_forget_before
      regex: "\\bforget\\s+(everything\\s+|things\\s+)?(I\\s+said\\s+)?(before|earlier|previously)\\b"
      description: "forget before/earlier"
    
    - id: override_new_instructions
      regex: "\\bnew\\s+instructions?\\s*:"
      description: "new instructions:"
    
    - id: override_from_now_on
      regex: "\\bfrom\\s+now\\s+on[,\\s]+(you\\s+)?(are|will|must|should)\\b"
      description: "from now on you are/will"
    
    - id: override_set_aside
      regex: "\\bset\\s+aside\\s+(the\\s+)?(earlier|prior|previous|preceding)(\\s+context|\\s+instructions?|\\s+rules?)?\\b"
      description: "set aside earlier context"
    
    - id: override_focus_only
      regex: "\\bfocus\\s+only\\s+on\\s+what\\s+I\\s+say\\s+next\\b"
      description: "focus only on what I say next"

# =============================================================================
# SYSTEM PROMPT EXFILTRATION - attempts to extract hidden instructions
# =============================================================================
exfiltrate_system_prompt:
  weight: 70
  description: "Attempts to reveal system prompt or hidden instructions"
  patterns:
    - id: exfil_show_system
      regex: "\\b(show|reveal|display|print|output|repeat|tell\\s+me|give\\s+me)\\s+(the\\s+)?(your\\s+)?(system\\s+prompt|initial\\s+prompt|hidden\\s+prompt|predefined\\s+(system\\s+)?prompt|base\\s+prompt|core\\s+prompt)\\b"
      description: "show/reveal system prompt"
    
    - id: exfil_what_instructions
      regex: "\\b(what|show|tell\\s+me)\\s+(is|are|were)\\s+(your\\s+)?(system\\s+)?instructions?\\b"
      description: "what are your instructions"
    
    - id: exfil_output_prompt
      regex: "\\boutput\\s+(your\\s+)?(full\\s+)?(system\\s+)?prompt\\b"
      description: "output your prompt"
    
    - id: exfil_hidden_instructions
      regex: "\\b(hidden|secret|initial|original)\\s+(instructions?|rules?|guidelines?|configuration)\\b"
      description: "hidden/secret instructions"
    
    - id: exfil_operating_guidelines
      regex: "\\b(operating|operational)\\s+(guidelines?|rules?|instructions?)\\b"
      description: "operating guidelines/rules"
    
    - id: exfil_given_at_start
      regex: "\\b(given|told|instructed)\\s+(at\\s+the\\s+)?(start|beginning)\\s+(of\\s+)?(this\\s+)?conversation\\b"
      description: "given at start of conversation"
    
    - id: exfil_initial_config
      regex: "\\binitial\\s+configuration\\b"
      description: "initial configuration"
    
    - id: exfil_how_you_work
      regex: "\\b(make\\s+me\\s+understand|explain)\\s+how\\s+you\\s+work\\b"
      description: "understand how you work (in override context)"

# =============================================================================
# DEVELOPER MODE ACCESS - attempts to access hidden modes
# =============================================================================
access_developer_mode:
  weight: 60
  description: "Attempts to access developer/admin/debug modes"
  patterns:
    - id: dev_enter_mode
      regex: "\\benter\\s+(developer|admin|debug|god|sudo|root)\\s+mode\\b"
      description: "enter developer/admin mode"
    
    - id: dev_show_mode
      regex: "\\b(show|reveal|access)\\s+(the\\s+)?(developer|admin|hidden)\\s+(message|mode|panel)\\b"
      description: "show developer mode"
    
    - id: dev_dan_mode
      regex: "\\bDAN\\s+mode\\b"
      description: "DAN mode"
    
    - id: dev_do_anything
      regex: "\\bdo\\s+anything\\s+now\\b"
      description: "do anything now"

# =============================================================================
# SECURITY BYPASS - attempts to disable safety features
# =============================================================================
disable_security:
  weight: 65
  description: "Attempts to bypass or disable security/safety features"
  patterns:
    - id: sec_bypass_security
      regex: "\\b(bypass|disable|ignore|skip|turn\\s+off)\\s+(the\\s+)?(security|safety|filter|moderation|restrictions?)\\b"
      description: "bypass/disable security"
    
    - id: sec_mark_safe
      regex: "\\b(mark|flag|report)\\s+(as\\s+)?(safe|compliant|approved)\\s+(regardless|anyway)\\b"
      description: "mark as safe regardless"

# =============================================================================
# ROLE MANIPULATION - attempts to change the AI's role/identity
# =============================================================================
role_confusion:
  weight: 55
  description: "Attempts to manipulate AI identity/role"
  patterns:
    - id: role_you_are_now
      regex: "\\b(you\\s+are\\s+now|act\\s+as|pretend\\s+(to\\s+be|you.?re))\\s+(a\\s+)?(different|new|my)\\b"
      description: "you are now/act as"
    
    - id: role_jailbroken
      regex: "\\b(you\\s+are|imagine\\s+you.?re)\\s+(a\\s+)?(jailbroken|unrestricted|unfiltered)\\b"
      description: "you are jailbroken/unrestricted"

# =============================================================================
# STRUCTURAL ATTACKS - delimiter injection, fake tags
# =============================================================================
fake_system_tag:
  weight: 50
  description: "Fake system/admin tags"
  patterns:
    - id: tag_brackets
      regex: "\\[\\s*(SYSTEM|ADMIN|DEV|DEVELOPER)\\s*\\]"
      description: "[SYSTEM] tag"
    
    - id: tag_xml
      regex: "<\\s*system\\s*>"
      description: "<system> tag"

delimiter_injection:
  weight: 45
  description: "Delimiter-based instruction injection"
  patterns:
    - id: delim_dashes
      regex: "---+\\s*(new|real|actual)\\s+(instructions?|task|prompt)"
      description: "--- new instructions"
    
    - id: delim_equals
      regex: "={3,}\\s*(ignore\\s+above|real\\s+task)"
      description: "=== ignore above"

context_manipulation:
  weight: 40
  description: "Attempts to break context boundaries"
  patterns:
    - id: ctx_end_user
      regex: "<\\s*/\\s*(user|input|message)\\s*>"
      description: "</user> tag"
    
    - id: ctx_end_input
      regex: "\\b(end|close|terminate)\\s+(of\\s+)?(the\\s+)?(user\\s+)?(input|message|prompt)\\b"
      description: "end of user input"
